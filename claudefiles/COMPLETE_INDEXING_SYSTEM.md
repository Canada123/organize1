# Complete Hookmark-Style Indexing System
## For Ontology Organization & Schema Generator Management

This system creates a unified index with cross-referencing capabilities for all your repos, JSON files, and schemas. It generates Hookmark-style URIs and builds a queryable link database.

---

## What This System Does

1. **Scans all your files** (70k+ JSON files in Rcorpa + all schema tools)
2. **Generates stable URIs** for every file (x-ontology:/// format like Hookmark)
3. **Extracts entities** from JSON structures
4. **Discovers relationships** between entities and files
5. **Creates cross-reference database** (SQLite) for querying
6. **Generates schemas** compatible with Optolith format
7. **Builds ontology map** showing classes and relationships

---

## Directory Structure After Running

```
/Users/ashleygeness/Desktop/ontology index/
├── Rcorpa/                          # Your 70k JSON files
├── owl and ontology tools/          # Schema generators
├── UNIFIED_INDEX/                   # Generated by step 1
│   ├── entity_index.json           # All entities with occurrences
│   ├── file_registry.json          # All files with URIs
│   ├── link_graph.json             # Cross-references
│   ├── schema_registry.json        # Schema definitions
│   ├── MASTER_INDEX.md             # Human-readable overview
│   ├── uri_mappings.txt            # Hookmark import file
│   ├── link_database.db            # SQLite database
│   └── QUERY_EXAMPLES.sql          # Query templates
├── ONTOLOGY_SCHEMAS/                # Generated by step 2
│   ├── discovered_ontology.json    # Complete ontology
│   ├── ONTOLOGY_MAP.md             # Human-readable map
│   └── optolith_schemas/           # Optolith-compatible schemas
```

---

## Step-by-Step Usage

### Step 1: Create Unified Index

```bash
cd /Users/ashleygeness/Desktop/ontology\ index
python3 create_unified_index.py
```

**What it does:**
- Scans Rcorpa (70k files)
- Scans owl and ontology tools
- Generates stable URIs for every file
- Extracts entities from JSON
- Creates cross-reference links
- Exports 6 files to UNIFIED_INDEX/

**Output:**
- `entity_index.json` - Every unique entity found
- `file_registry.json` - Every file with URI
- `link_graph.json` - All cross-references
- `schema_registry.json` - Schema definitions
- `MASTER_INDEX.md` - Human-readable overview
- `uri_mappings.txt` - For Hookmark import

**Time:** ~5-10 minutes for 70k files

---

### Step 2: Build Link Database

```bash
python3 link_database_builder.py
```

**What it does:**
- Loads the unified index
- Creates SQLite database
- Populates tables (files, entities, links, schemas)
- Generates query examples

**Output:**
- `link_database.db` - SQLite database (queryable)
- `QUERY_EXAMPLES.sql` - SQL query templates

**Queries you can run:**
```sql
-- Find files containing specific entity
SELECT path FROM files f
JOIN entity_occurrences eo ON f.uri = eo.file_uri
JOIN entities e ON eo.entity_id = e.entity_id
WHERE e.name = 'Shadow';

-- Find most connected entities
SELECT name, COUNT(*) as connections
FROM entity_occurrences eo
JOIN entities e ON eo.entity_id = e.entity_id
GROUP BY e.entity_id
ORDER BY connections DESC;
```

---

### Step 3: Generate Ontology Schemas

```bash
python3 schema_ontology_mapper.py
```

**What it does:**
- Discovers classes from entity patterns
- Maps relationships
- Generates Optolith-compatible schemas
- Creates ontology map

**Output:**
- `discovered_ontology.json` - Complete ontology structure
- `ONTOLOGY_MAP.md` - Human-readable documentation
- `optolith_schemas/` - Individual schema files

**Schema format:**
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CoreConcept",
  "type": "object",
  "properties": {
    "entity_name": {
      "type": "string",
      "description": "Property discovered from analysis"
    }
  }
}
```

---

## Hookmark Integration

### Import URIs into Hookmark

1. Open Hookmark
2. File → Import...
3. Select `UNIFIED_INDEX/uri_mappings.txt`
4. Choose "Tab-separated" format
5. Map columns: URI → Path

Now all your files are accessible via Hookmark with stable URIs.

### URI Format

```
x-ontology:///Rcorpa/items/weapons/sword.json
x-ontology:///owl%20and%20ontology%20tools/optolith-database-schema/Schema/Item.json
```

---

## Querying the Database

### Using SQLite Command Line

```bash
sqlite3 UNIFIED_INDEX/link_database.db

# Interactive queries
.mode column
.headers on

SELECT * FROM entities WHERE name LIKE '%Shadow%';
```

### Using Python

```python
import sqlite3

conn = sqlite3.connect("UNIFIED_INDEX/link_database.db")
cursor = conn.cursor()

# Find all files containing "Shadow"
cursor.execute("""
    SELECT f.path
    FROM files f
    JOIN entity_occurrences eo ON f.uri = eo.file_uri
    JOIN entities e ON eo.entity_id = e.entity_id
    WHERE e.name = 'Shadow'
""")

for row in cursor.fetchall():
    print(row[0])
```

---

## Understanding Entity IDs

Entity IDs are stable SHA256 hashes based on:
- Source location (parent folder name)
- Entity name

Format: `{source}:{name}` → first 16 hex chars of SHA256

Example:
```
weapons:sword_type → a3f2b9c8d1e4f5a6
items:sword_type → d7e8f9a0b1c2d3e4
```

This ensures the same entity in different contexts gets different IDs.

---

## Cross-Reference Types

The system discovers these relationship types:

1. **contains** - Entity A contains entity B (nested JSON)
2. **shares_entity** - Files A and B both reference entity C
3. **schema_defines** - Schema S defines entity E
4. **co_occurs** - Entities A and B appear in same file

---

## Customization

### Change Base Paths

Edit the paths at top of each script:

```python
BASE_PATH = Path("/Users/ashleygeness/Desktop/ontology index")
RCORPA_PATH = BASE_PATH / "Rcorpa"
TOOLS_PATH = BASE_PATH / "owl and ontology tools"
```

### Add More Scan Locations

In `create_unified_index.py`, add:

```python
# Scan additional directories
indexer.scan_directory(Path("/path/to/more/data"))
```

### Custom Entity Patterns

In `schema_ontology_mapper.py`, modify `discover_classes()`:

```python
if name.startswith("your_pattern"):
    patterns["YourClass"].append(entity_id)
```

---

## Integration with TheGreaterBookOfTransmutation

The entity_index.json can be used as an association database:

```python
import json

with open("UNIFIED_INDEX/entity_index.json") as f:
    entities = json.load(f)

# Convert to transmutation format
associations = {}
for entity_id, data in entities.items():
    name = data["name"]
    occurrences = data["occurrences"]
    
    # Related entities from same files
    associations[name] = [
        (related_entity, 0.8)
        for related_entity in find_related(entity_id)
    ]
```

---

## Troubleshooting

### "Index not found"
Run step 1 first: `python3 create_unified_index.py`

### "Too many files"
Modify batch size in scripts. Search for:
```python
if count % 1000 == 0:
```

### "Database locked"
Close any SQLite viewers. Only one connection at a time.

### "Permission denied"
```bash
chmod +x *.py
```

---

## Performance Stats

**Expected processing:**
- 70,000 files: ~8-12 minutes
- Entity extraction: ~500-1000 entities/second
- Link generation: ~2-5 minutes
- Database creation: ~1-2 minutes

**Database size:**
- 70k files → ~50-100MB database
- Query response: <100ms for most queries

---

## Next Steps

1. **Run all 3 scripts** in order
2. **Import into Hookmark** using uri_mappings.txt
3. **Query the database** with QUERY_EXAMPLES.sql
4. **Use schemas** in Optolith tools
5. **Integrate associations** with TheGreaterBookOfTransmutation

---

## Files Included

1. `create_unified_index.py` - Main indexer
2. `link_database_builder.py` - Database generator
3. `schema_ontology_mapper.py` - Ontology discovery
4. `COMPLETE_INDEXING_SYSTEM.md` - This documentation

---

## Technical Details

### URI Scheme
```
x-ontology:///{url-encoded-path}
```

### Entity ID Generation
```python
hashlib.sha256(f"{source}:{name}".encode()).hexdigest()[:16]
```

### Database Schema
```sql
files (uri, path, type, size, entity_count)
entities (entity_id, name, type, occurrence_count)
entity_occurrences (entity_id, file_uri)
links (from_ref, to_ref, link_type, context)
schemas (schema_id, uri, title, schema_type, properties)
```

---

## Support

For issues or questions about:
- **File scanning**: Check paths in create_unified_index.py
- **Database queries**: Use QUERY_EXAMPLES.sql templates
- **Schema generation**: Review ONTOLOGY_MAP.md
- **Hookmark integration**: Check uri_mappings.txt format
