{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "roadmap.schema.json",
  "title": "Project Roadmap Schema",
  "description": "Schema for project roadmap and task tracking",
  "type": "object",
  "required": ["version", "last_updated", "current_sprint", "epics", "features", "tasks"],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "last_updated": {
      "type": "string",
      "format": "date"
    },
    "current_sprint": {
      "type": "string",
      "pattern": "^\\d{4}-W\\d{2}$",
      "description": "ISO 8601 week format (YYYY-Www)"
    },
    "epics": {
      "type": "object",
      "patternProperties": {
        "^EPIC-\\d{3}$": {
          "type": "object",
          "required": ["title", "status", "description"],
          "properties": {
            "title": { "type": "string" },
            "status": {
              "type": "string",
              "enum": ["planning", "in_progress", "completed", "blocked"]
            },
            "progress_percentage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "description": { "type": "string" },
            "start_date": { "type": "string", "format": "date" },
            "target_completion": { "type": "string", "format": "date" },
            "completion_date": { "type": "string", "format": "date" },
            "features": {
              "type": "array",
              "items": { "type": "string", "pattern": "^FEAT-\\d{3}$" }
            }
          }
        }
      }
    },
    "features": {
      "type": "object",
      "patternProperties": {
        "^FEAT-\\d{3}$": {
          "type": "object",
          "required": ["title", "epic", "status"],
          "properties": {
            "title": { "type": "string" },
            "epic": { "type": "string", "pattern": "^EPIC-\\d{3}$" },
            "status": {
              "type": "string",
              "enum": ["pending", "in_progress", "completed", "blocked"]
            },
            "deliverables": {
              "type": "array",
              "items": { "type": "string" }
            },
            "dependencies": {
              "type": "array",
              "items": { "type": "string", "pattern": "^FEAT-\\d{3}$" }
            },
            "assignee": { "type": "string" },
            "priority": {
              "type": "string",
              "enum": ["critical", "high", "medium", "low"]
            }
          }
        }
      }
    },
    "tasks": {
      "type": "object",
      "required": ["active", "pending", "completed"],
      "properties": {
        "active": {
          "type": "array",
          "items": { "$ref": "#/definitions/task" }
        },
        "pending": {
          "type": "array",
          "items": { "$ref": "#/definitions/task" }
        },
        "completed": {
          "type": "array",
          "items": { "$ref": "#/definitions/task" }
        },
        "backlog": {
          "type": "array",
          "items": { "$ref": "#/definitions/task" }
        }
      }
    },
    "milestones": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "date", "deliverables"],
        "properties": {
          "name": { "type": "string" },
          "date": { "type": "string", "format": "date" },
          "deliverables": {
            "type": "array",
            "items": { "type": "string" }
          },
          "status": {
            "type": "string",
            "enum": ["upcoming", "completed", "missed"]
          }
        }
      }
    },
    "metrics": {
      "type": "object",
      "properties": {
        "velocity": {
          "type": "object",
          "properties": {
            "current_sprint": { "type": "number" },
            "average": { "type": "number" },
            "trend": {
              "type": "string",
              "enum": ["increasing", "stable", "decreasing"]
            }
          }
        },
        "quality": {
          "type": "object",
          "properties": {
            "test_coverage": { "type": "number", "minimum": 0, "maximum": 100 },
            "bug_rate": { "type": "number", "minimum": 0 },
            "code_quality_score": { "type": "number", "minimum": 0, "maximum": 10 }
          }
        },
        "progress": {
          "type": "object",
          "properties": {
            "epics_completed": { "type": "integer", "minimum": 0 },
            "epics_in_progress": { "type": "integer", "minimum": 0 },
            "features_completed": { "type": "integer", "minimum": 0 },
            "features_in_progress": { "type": "integer", "minimum": 0 },
            "tasks_completed_this_week": { "type": "integer", "minimum": 0 }
          }
        }
      }
    }
  },
  "definitions": {
    "task": {
      "type": "object",
      "required": ["id", "title", "status"],
      "properties": {
        "id": { "type": "string", "pattern": "^[TB]-\\d{3}$" },
        "feature": { "type": "string", "pattern": "^FEAT-\\d{3}$" },
        "title": { "type": "string" },
        "status": {
          "type": "string",
          "enum": ["pending", "in_progress", "completed", "blocked"]
        },
        "priority": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"]
        },
        "estimated_hours": { "type": "number", "minimum": 0 },
        "actual_hours": { "type": "number", "minimum": 0 },
        "assignee": { "type": "string" },
        "dependencies": {
          "type": "array",
          "items": { "type": "string", "pattern": "^[TB]-\\d{3}$" }
        },
        "started_at": { "type": "string", "format": "date-time" },
        "completed_at": { "type": "string", "format": "date-time" }
      }
    }
  }
}