{
  "session_id": "440fb416-bfcf-4ddb-8843-8b196e60dcd6",
  "transcript_path": "/Users/yangsim/.claude/projects/-Users-yangsim-Nanoleq-sideProjects-skinn-convert-swiss-pages/440fb416-bfcf-4ddb-8843-8b196e60dcd6.jsonl",
  "hook_event_name": "PreToolUse",
  "tool_name": "Write",
  "tool_input": {
    "file_path": "/Users/yangsim/Nanoleq/sideProjects/skinn-convert-swiss-pages/.claude/hooks/update-event-stream.py",
    "content": "#!/usr/bin/env python3\n\"\"\"\nEnhanced Event Stream Logger\n\"\"\"\nimport json\nimport sys\nimport os\nimport re\nfrom datetime import datetime\nfrom pathlib import Path\n\n# Event type mapping\nTOOL_EVENT_MAPPING = {\n    'Write': 'Action', 'Edit': 'Action', 'MultiEdit': 'Action',\n    'TodoWrite': 'PlanUpdate', 'Task': 'Action',\n    'Read': 'Observation', 'WebSearch': 'Research',\n    'mcp__memory__create_entities': 'GraphUpdate',\n    'mcp__memory__store': 'MemoryStore',\n}\n\ndef detect_current_task(project_dir):\n    \"\"\"Extract current task ID from todo.md.\"\"\"\n    todo_path = Path(project_dir) / 'context' / 'todo.md'\n    if not todo_path.exists():\n        return None\n    \n    try:\n        with open(todo_path, 'r') as f:\n            content = f.read()\n        \n        # Find section headers with task IDs [SEC-001]\n        section_tasks = re.findall(r'##.*?\\[([A-Z]+-\\d+(?:\\.\\d+)?)\\]', content)\n        if section_tasks:\n            return section_tasks[0]\n            \n    except Exception:\n        pass\n    \n    return None\n\ndef infer_reason(tool_name, tool_input):\n    \"\"\"Infer the reason/context for the action.\"\"\"\n    reasons = []\n    \n    if tool_name == 'Write':\n        file_path = tool_input.get('file_path', '')\n        if '.md' in file_path:\n            reasons.append(\"updating documentation\")\n        elif 'context' in file_path:\n            reasons.append(\"updating working files\")\n    elif tool_name == 'TodoWrite':\n        todos = tool_input.get('todos', [])\n        completed = sum(1 for t in todos if t.get('status') == 'completed')\n        if completed > 0:\n            reasons.append(f\"completing {completed} task(s)\")\n    \n    return f\" ({', '.join(reasons)})\" if reasons else \"\"\n\ndef format_enhanced_event_description(tool_name, tool_input, project_dir):\n    \"\"\"Generate an enhanced description.\"\"\"\n    # Base description\n    if tool_name == 'Write':\n        file_name = os.path.basename(tool_input.get('file_path', 'unknown'))\n        description = f\"Created/updated {file_name}\"\n    elif tool_name == 'TodoWrite':\n        todos = tool_input.get('todos', [])\n        completed = sum(1 for t in todos if t.get('status') == 'completed')\n        in_progress = sum(1 for t in todos if t.get('status') == 'in_progress')\n        pending = sum(1 for t in todos if t.get('status') == 'pending')\n        description = f\"Updated todos: {completed} completed, {in_progress} in progress, {pending} pending\"\n    else:\n        description = f\"{tool_name} operation completed\"\n    \n    # Add task context\n    task_id = detect_current_task(project_dir)\n    if task_id:\n        description = f\"[{task_id}] {description}\"\n    \n    # Add reason\n    reason = infer_reason(tool_name, tool_input)\n    if reason:\n        description += reason\n    \n    return description\n\ndef append_event(event_line, event_stream_path):\n    \"\"\"Append event to stream.\"\"\"\n    try:\n        with open(event_stream_path, 'r') as f:\n            lines = f.readlines()\n        \n        # Find last event line\n        last_event_index = -1\n        for i in range(len(lines) - 1, -1, -1):\n            if lines[i].strip().startswith('['):\n                last_event_index = i\n                break\n        \n        # Insert after last event\n        if last_event_index == -1:\n            lines.append(event_line + '\\n')\n        else:\n            lines.insert(last_event_index + 1, event_line + '\\n')\n        \n        with open(event_stream_path, 'w') as f:\n            f.writelines(lines)\n        \n        return True\n    except Exception as e:\n        print(f\"Error: {e}\", file=sys.stderr)\n        return False\n\ndef main():\n    \"\"\"Main function.\"\"\"\n    try:\n        input_data = json.load(sys.stdin)\n        \n        if input_data.get('hook_event_name') != 'PostToolUse':\n            sys.exit(0)\n        \n        tool_name = input_data.get('tool_name', '')\n        if tool_name in ['LS', 'BashOutput']:\n            sys.exit(0)\n        \n        tool_input = input_data.get('tool_input', {})\n        project_dir = os.environ.get('CLAUDE_PROJECT_DIR', os.getcwd())\n        event_stream_path = Path(project_dir) / 'context' / 'event-stream.md'\n        \n        # Generate enhanced event\n        timestamp = datetime.now().strftime('[%Y-%m-%d %H:%M]')\n        event_type = TOOL_EVENT_MAPPING.get(tool_name, 'Action')\n        description = format_enhanced_event_description(tool_name, tool_input, project_dir)\n        \n        event_line = f\"{timestamp} {event_type} - {description}\"\n        \n        if append_event(event_line, event_stream_path):\n            print(f\"üìù Enhanced event: {event_line}\")\n    \n    except Exception as e:\n        print(f\"Hook error: {e}\", file=sys.stderr)\n    \n    sys.exit(0)\n\nif __name__ == '__main__':\n    main()"
  }
}